<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SATHERLON - Luxury Vintage</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Lato', sans-serif;
            --color-gold: #C5A059;
            --color-black: #1A1A1A;
            --color-cream: #F9F8F4;
            --color-beige: #EBE5D9;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--color-cream);
            color: var(--color-black);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        h1, h2, h3, h4, h5, .font-serif {
            font-family: var(--font-serif);
        }

        /* --- Animations --- */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-enter {
            animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Size Selection Animation */
        @keyframes popScale {
            0% { transform: scale(1); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .size-btn {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .size-btn:active {
            transform: scale(0.85);
        }
        .size-btn.selected {
            animation: popScale 0.3s ease-out;
            background-color: var(--color-black);
            color: white;
            border-color: var(--color-black);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Add to Cart Animation */
        .btn-add {
            transition: transform 0.1s, background-color 0.3s;
            position: relative;
            overflow: hidden;
        }
        .btn-add:active {
            transform: scale(0.97);
        }
        .btn-add.added::after {
            content: "Added";
            position: absolute;
            inset: 0;
            background-color: var(--color-gold);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            letter-spacing: 0.1em;
            animation: fadeIn 0.3s;
        }

        /* Swipe Gallery Styles */
        .gallery-container {
            position: relative;
            overflow: hidden;
            touch-action: pan-y; /* Allow vertical scroll but capture horizontal */
        }
        
        .gallery-track {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            height: 100%;
            width: 100%;
        }

        .gallery-item {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none; /* Prevent image drag interfering with swipe */
        }

        /* Dots Indicator */
        .dot {
            transition: all 0.3s ease;
        }
        .dot.active {
            background-color: var(--color-black);
            transform: scale(1.3);
        }

        /* 3D Flip (Storefront) */
        .flip-container { perspective: 1000px; }
        .flip-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d;
        }
        .flip-inner.is-flipped { transform: rotateY(180deg); }
        .flip-front, .flip-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            top: 0; left: 0;
        }
        .flip-back { transform: rotateY(180deg); }

        /* Utilities */
        .btn-primary {
            background-color: var(--color-black);
            color: white;
            border: 1px solid var(--color-black);
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: white;
            color: var(--color-black);
        }

        .nav-link.active { color: var(--color-gold); }
        .nav-link.active::after { width: 100%; }
        
        .page-section { display: none; }
        .page-section.active { display: block; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--color-gold); border-radius: 3px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-[#F9F8F4]/95 backdrop-blur-md border-b border-[#B4AEA4]/20 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-24">
                <div class="flex-shrink-0 cursor-pointer group" onclick="app.showPage('home')">
                    <h1 class="text-3xl tracking-[0.15em] font-bold text-[#1A1A1A] group-hover:text-[#C5A059] transition-colors duration-500">
                        SATHERLON
                    </h1>
                    <p class="text-[10px] tracking-[0.4em] text-[#C5A059] uppercase text-center mt-1 font-sans font-semibold">Luxury Vintage</p>
                </div>
                
                <div class="hidden md:flex space-x-10 text-xs uppercase tracking-[0.2em] text-[#1A1A1A] font-semibold" id="nav-filters">
                    <button onclick="app.filterCategory('All')" class="nav-link relative py-2 hover:text-[#C5A059] transition-colors after:content-[''] after:absolute after:w-0 after:h-[1px] after:bg-[#C5A059] after:bottom-0 after:left-0 after:transition-all hover:after:w-full active">Shop All</button>
                    <button onclick="app.filterCategory('Hoodie')" class="nav-link relative py-2 hover:text-[#C5A059] transition-colors after:content-[''] after:absolute after:w-0 after:h-[1px] after:bg-[#C5A059] after:bottom-0 after:left-0 after:transition-all hover:after:w-full">Hoodies</button>
                    <button onclick="app.filterCategory('T-Shirt')" class="nav-link relative py-2 hover:text-[#C5A059] transition-colors after:content-[''] after:absolute after:w-0 after:h-[1px] after:bg-[#C5A059] after:bottom-0 after:left-0 after:transition-all hover:after:w-full">T-Shirts</button>
                </div>

                <div class="flex items-center space-x-6 text-[#1A1A1A]">
                    <button onclick="app.showPage('admin')" id="admin-btn" class="hidden hover:text-[#C5A059] transition-transform hover:scale-110">
                        <i data-lucide="layout-dashboard" width="20"></i>
                    </button>
                    <button onclick="app.handleAuthClick()" class="hover:text-[#C5A059] flex items-center gap-2 transition-transform hover:scale-110">
                        <i id="auth-icon" data-lucide="user" width="20"></i>
                    </button>
                    <div class="relative cursor-pointer transition-transform hover:scale-110" onclick="app.toggleCart(true)">
                        <i data-lucide="shopping-bag" width="20"></i>
                        <span id="cart-count" class="hidden absolute -top-1 -right-2 bg-[#C5A059] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-sans font-bold">0</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cart Drawer -->
    <div id="cart-drawer" class="fixed inset-0 z-[60] flex justify-end pointer-events-none opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-[#1A1A1A]/30 backdrop-blur-sm" onclick="app.toggleCart(false)"></div>
        <div id="cart-content" class="relative w-full max-w-md bg-white h-full shadow-2xl transform translate-x-full transition-transform duration-300 ease-out flex flex-col pointer-events-auto">
            <div class="p-6 border-b border-[#EBE5D9] flex justify-between items-center bg-[#F9F8F4]">
                <h2 class="text-xl font-serif">Your Bag</h2>
                <button onclick="app.toggleCart(false)" class="hover:rotate-90 transition-transform duration-300"><i data-lucide="x"></i></button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6"></div>
            <div id="cart-footer" class="p-8 border-t border-[#EBE5D9] bg-[#F9F8F4] hidden">
                <div class="flex justify-between mb-6 text-xl font-serif"><span>Total</span><span id="cart-total">0 ฿</span></div>
                <button class="btn-primary w-full py-3 text-sm uppercase tracking-widest">Proceed to Checkout</button>
            </div>
            <div id="cart-empty-msg" class="text-center text-[#B4AEA4] mt-20 font-light hidden">Your bag is empty.</div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow">
        
        <!-- HOME PAGE -->
        <section id="home-page" class="page-section active animate-enter">
            <header class="relative h-[70vh] bg-[#EBE5D9] flex items-center justify-center overflow-hidden mb-16">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1500&q=80')] bg-cover bg-center opacity-40 grayscale mix-blend-multiply"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-[#F9F8F4] to-transparent opacity-50"></div>
                <div class="relative text-center z-10 px-4 animate-enter" style="animation-delay: 0.1s;">
                    <p class="text-xs tracking-[0.6em] text-[#1A1A1A] mb-6 uppercase font-bold">New Arrival</p>
                    <h1 class="text-6xl md:text-8xl font-bold mb-8 text-[#1A1A1A]">URBAN<br/><span class="italic font-light font-serif">ELEGANCE</span></h1>
                    <button onclick="document.getElementById('shop').scrollIntoView({ behavior: 'smooth' })" class="btn-primary px-8 py-3 text-sm uppercase tracking-widest">Explore Collection</button>
                </div>
            </header>

            <div id="shop" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-10 flex flex-col md:flex-row justify-between items-center gap-6">
                <h2 class="text-2xl italic text-[#1A1A1A] font-serif">Selected Items</h2>
                <div class="relative w-full md:w-72">
                    <input type="text" id="search-input" placeholder="Search..." oninput="app.handleSearch(this.value)" class="w-full bg-transparent border-b border-[#B4AEA4] py-2 pl-2 pr-8 focus:outline-none focus:border-[#1A1A1A] font-sans text-sm transition-colors">
                    <i data-lucide="search" class="absolute right-0 top-2 text-[#B4AEA4]" width="16"></i>
                </div>
            </div>

            <div id="product-grid" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-12 mb-20"></div>
            <div id="no-results" class="hidden text-center py-20 text-[#B4AEA4] font-light italic">No products found.</div>
        </section>

        <!-- PRODUCT DETAIL PAGE (With Swipe) -->
        <section id="product-page" class="page-section">
            <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
                <button onclick="app.showPage('home')" class="mb-8 text-xs uppercase tracking-widest flex items-center text-[#B4AEA4] hover:text-[#1A1A1A] transition-colors">
                    <i data-lucide="arrow-right" class="rotate-180 mr-2" width="16"></i> Back to Collection
                </button>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                    <!-- Swipeable Image Gallery -->
                    <div class="space-y-6 animate-enter" style="animation-delay: 0.1s;">
                        <div class="aspect-[3/4] bg-[#F5F5F0] overflow-hidden relative shadow-inner group">
                            <!-- Touch Event Container -->
                            <div class="gallery-container w-full h-full" id="swipe-area">
                                <div class="gallery-track w-full h-full" id="gallery-track">
                                    <!-- Images will be injected here -->
                                </div>
                            </div>
                            
                            <!-- Desktop Navigation Arrows (Optional, visible on hover) -->
                            <button onclick="app.prevImage()" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white"><i data-lucide="chevron-left"></i></button>
                            <button onclick="app.nextImage()" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white"><i data-lucide="chevron-right"></i></button>

                            <!-- Dots -->
                            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex space-x-3 bg-white/50 backdrop-blur px-4 py-2 rounded-full z-10">
                                <button onclick="app.goToImage(0)" class="w-2 h-2 rounded-full bg-[#1A1A1A] dot active" id="dot-0"></button>
                                <button onclick="app.goToImage(1)" class="w-2 h-2 rounded-full bg-[#B4AEA4] dot" id="dot-1"></button>
                            </div>
                            
                            <div class="absolute bottom-20 left-0 right-0 text-center text-[10px] text-[#B4AEA4] uppercase tracking-widest opacity-50 pointer-events-none md:hidden">
                                Swipe to view back
                            </div>
                        </div>
                    </div>

                    <!-- Info -->
                    <div class="flex flex-col justify-center animate-enter" style="animation-delay: 0.2s;">
                        <span class="text-[#C5A059] tracking-[0.2em] uppercase text-xs font-bold mb-2">Vintage Collection</span>
                        <h1 id="detail-name" class="text-4xl lg:text-5xl mb-2 text-[#1A1A1A] leading-tight font-serif"></h1>
                        <div class="flex items-center space-x-4 mb-6 border-b border-[#EBE5D9] pb-4">
                            <p id="detail-price" class="font-serif text-3xl text-[#1A1A1A]"></p>
                        </div>
                        <p id="detail-desc" class="text-[#555] leading-loose mb-10 font-light text-base"></p>

                        <!-- Tabs -->
                        <div class="mb-10">
                            <div class="flex space-x-8 border-b border-[#EBE5D9] mb-6">
                                <button onclick="app.switchTab('details')" id="tab-details" class="pb-3 text-xs uppercase tracking-[0.15em] transition-all border-b-2 border-[#1A1A1A] font-bold">Details</button>
                                <button onclick="app.switchTab('size')" id="tab-size" class="pb-3 text-xs uppercase tracking-[0.15em] transition-all border-transparent text-[#B4AEA4]">Size Chart</button>
                            </div>
                            <div id="tab-content" class="min-h-[120px] text-sm text-[#555] font-light leading-relaxed"></div>
                        </div>

                        <!-- Selectors -->
                        <div class="mb-8">
                            <label class="block text-xs uppercase tracking-widest mb-3 text-[#1A1A1A] font-bold">Select Size</label>
                            <div id="size-selector" class="flex flex-wrap gap-3"></div>
                        </div>

                        <div class="flex items-center space-x-4 mb-8">
                            <div class="flex items-center border border-[#EBE5D9] h-14 w-32 bg-white">
                                <button onclick="app.updateDetailQty(-1)" class="w-10 h-full hover:bg-[#F5F5F0] transition">-</button>
                                <div id="detail-qty" class="flex-1 text-center font-serif text-lg">1</div>
                                <button onclick="app.updateDetailQty(1)" class="w-10 h-full hover:bg-[#F5F5F0] transition">+</button>
                            </div>
                            <button onclick="app.addCurrentToCart()" id="detail-add-btn" class="btn-add btn-primary flex-1 h-14 text-sm tracking-widest">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- LOGIN & ADMIN PAGES (Same as before) -->
        <section id="login-page" class="page-section">
             <div class="flex items-center justify-center min-h-[70vh] px-4 relative overflow-hidden animate-enter">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-[#EBE5D9] rounded-full opacity-20 blur-3xl z-0 pointer-events-none"></div>
                <div class="w-full max-w-md bg-white p-10 shadow-2xl z-10 relative border border-[#EBE5D9]">
                    <div class="text-center mb-10">
                        <h2 class="text-4xl text-[#1A1A1A] mb-2 font-serif">Member Login</h2>
                        <div class="w-12 h-[2px] bg-[#C5A059] mx-auto mb-4"></div>
                        <p class="text-[#B4AEA4] text-xs uppercase tracking-[0.2em]">Enter your credentials</p>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-[10px] uppercase tracking-widest mb-2 text-[#555]">Username</label>
                            <input type="text" id="username" class="w-full bg-[#F9F8F4] border-b border-[#EBE5D9] p-3 focus:outline-none focus:border-[#C5A059] transition-colors text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] uppercase tracking-widest mb-2 text-[#555]">Password</label>
                            <input type="password" id="password" class="w-full bg-[#F9F8F4] border-b border-[#EBE5D9] p-3 focus:outline-none focus:border-[#C5A059] transition-colors text-sm">
                        </div>
                        <button onclick="app.login()" class="btn-primary w-full mt-4 h-12 shadow-md">Sign In</button>
                        <div class="text-center mt-6"><p class="text-xs text-[#B4AEA4]">Demo: <span class="text-[#1A1A1A] font-semibold">admin / admin</span></p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="admin-page" class="page-section animate-enter">
             <div class="max-w-7xl mx-auto px-4 py-12">
                <h2 class="font-serif text-3xl mb-8">Admin Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                     <div class="bg-white p-6 border border-[#EBE5D9] shadow-sm"><h3 class="text-sm uppercase tracking-widest text-[#B4AEA4]">Total Sales</h3><p class="text-3xl font-serif mt-2">124,500 ฿</p></div>
                     <div class="bg-white p-6 border border-[#EBE5D9] shadow-sm"><h3 class="text-sm uppercase tracking-widest text-[#B4AEA4]">Orders</h3><p class="text-3xl font-serif mt-2">45</p></div>
                     <div class="bg-white p-6 border border-[#EBE5D9] shadow-sm"><h3 class="text-sm uppercase tracking-widest text-[#B4AEA4]">Stock</h3><p class="text-3xl font-serif mt-2">1,203</p></div>
                </div>
                <div class="bg-white border border-[#EBE5D9] p-8 text-center text-[#B4AEA4]">Product Management Table (Mockup)</div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-[#191919] text-[#EBE5D9] pt-16 pb-8 border-t border-[#C5A059]/30">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-12 text-center md:text-left mb-12">
            <div>
                <h4 class="text-2xl tracking-widest mb-6 font-bold font-serif">SATHERLON</h4>
                <p class="text-[#888] text-sm leading-relaxed max-w-xs mx-auto md:mx-0 font-sans font-light">Redefining urban luxury with minimal aesthetics and premium materials.</p>
            </div>
            <div>
                <h5 class="uppercase tracking-[0.2em] text-[10px] mb-6 text-[#C5A059] font-bold">Customer Care</h5>
                <ul class="space-y-3 text-sm text-[#AAA] font-sans font-light">
                    <li class="hover:text-white cursor-pointer transition-colors">Shipping & Returns</li>
                    <li class="hover:text-white cursor-pointer transition-colors">Contact Us</li>
                </ul>
            </div>
            <div>
                <h5 class="uppercase tracking-[0.2em] text-[10px] mb-6 text-[#C5A059] font-bold">Connect With Us</h5>
                <div class="flex justify-center md:justify-start space-x-6">
                    <a href="#" class="hover:text-[#C5A059] transition-colors"><i data-lucide="instagram"></i></a>
                    <a href="#" class="hover:text-[#C5A059] transition-colors"><i data-lucide="facebook"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center border-t border-[#333] pt-8 text-[10px] text-[#555] uppercase tracking-widest font-sans">© 2024 Satherlon. All rights reserved.</div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- CONFIG FOR USER ---
        // ให้นำไฟล์ im1.jpg, im2.jpg มาวางไว้โฟลเดอร์เดียวกับไฟล์นี้ ถ้าต้องการใช้ไฟล์ในเครื่อง
        const IMAGES = {
            // Placeholder: "https://images.unsplash.com/..."
            // Your File: "im1.jpg"
            hoodie_front: "im1.jpg",
            hoodie_back: "im2.jpg", 
            
            tshirt_front: "im3.jpg", 
            tshirt_back: "im4.jpg" 
        };

        const SIZE_CHART = [
            { size: 'S', width: 20.08, length: 27.17, sleeve: 33.50 },
            { size: 'M', width: 22.05, length: 27.95, sleeve: 34.50 },
            { size: 'L', width: 24.02, length: 29.13, sleeve: 35.50 },
            { size: 'XL', width: 25.98, length: 29.92, sleeve: 36.50 },
            { size: '2XL', width: 27.99, length: 31.10, sleeve: 37.50 },
            { size: '3XL', width: 29.92, length: 31.89, sleeve: 38.50 },
            { size: '4XL', width: 31.89, length: 33.07, sleeve: 39.50 },
            { size: '5XL', width: 33.86, length: 33.86, sleeve: 40.50 },
        ];

        const MOCK_PRODUCTS = [
            {
                id: 1,
                name: "SATHERLON Minimal Hoodie",
                category: "Hoodie",
                price: 359,
                description: "Soft, roomy, and quietly bold. The minimalist front text and larger back graphic sit cleanly on a crisp white canvas.",
                details: ["50/50 cotton-poly medium-heavy fabric", "No side seams", "DTF sleeve prints"],
                images: [IMAGES.hoodie_front, IMAGES.hoodie_back] // im1.jpg (Front/Back)
            },
            {
                id: 2,
                name: "XAUUSD Gold Edition Tee",
                category: "T-Shirt",
                price: 199,
                description: "Wearable statement that slips into an urban routine. Features gold coin graphic inspired by trading markets.",
                details: ["100% Premium Cotton", "Breathable fabric", "Modern streetwise edge print"],
                images: [IMAGES.tshirt_front, IMAGES.tshirt_back] // im2.jpg (Front/Back)
            },
            {
                id: 3,
                name: "Classic Beige Oversized",
                category: "Hoodie",
                price: 579,
                description: "Everyday comfort with double-lined hood. Ideal for early mornings and late-night walks.",
                details: ["Oversized Fit", "Kangaroo pocket", "Ethical cotton sourcing"],
                images: ["https://images.unsplash.com/photo-1564557287817-3785e38ec1f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80", "https://images.unsplash.com/photo-1564557287817-3785e38ec1f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"]
            }
        ];

        // --- APP LOGIC ---
        const app = {
            state: {
                cart: [],
                currentCategory: 'All',
                searchQuery: '',
                selectedProduct: null,
                detailActiveSize: 'M',
                detailQty: 1,
                currentImageIndex: 0,
                touchStartX: 0,
                touchEndX: 0
            },

            init() {
                this.renderProducts();
                lucide.createIcons();
                this.setupSwipe();
            },

            showPage(pageId) {
                document.querySelectorAll('.page-section').forEach(el => {
                    el.classList.remove('active');
                    el.classList.remove('animate-enter');
                });
                const newPage = document.getElementById(pageId + '-page');
                newPage.classList.add('active');
                void newPage.offsetWidth; 
                newPage.classList.add('animate-enter');
            },

            filterCategory(cat) {
                this.state.currentCategory = cat;
                document.querySelectorAll('#nav-filters button').forEach(btn => {
                    btn.classList.remove('active');
                    if(btn.innerText.includes(cat) || (cat==='All' && btn.innerText==='Shop All')) btn.classList.add('active');
                });
                this.renderProducts();
                this.showPage('home');
            },

            handleSearch(val) {
                this.state.searchQuery = val.toLowerCase();
                this.renderProducts();
            },

            renderProducts() {
                const grid = document.getElementById('product-grid');
                grid.innerHTML = '';
                const filtered = MOCK_PRODUCTS.filter(p => 
                    (this.state.currentCategory === 'All' || p.category === this.state.currentCategory) && 
                    p.name.toLowerCase().includes(this.state.searchQuery)
                );

                if (filtered.length === 0) document.getElementById('no-results').classList.remove('hidden');
                else {
                    document.getElementById('no-results').classList.add('hidden');
                    filtered.forEach((p, index) => {
                        const card = document.createElement('div');
                        card.className = 'group relative bg-transparent overflow-hidden animate-enter';
                        card.style.animationDelay = `${index * 0.1}s`;
                        card.innerHTML = `
                            <div class="flip-container aspect-[3/4] w-full cursor-pointer" onclick="app.openProduct(${p.id})">
                                <div class="flip-inner h-full shadow-md group-hover:shadow-xl transition-shadow duration-500" id="flip-${p.id}">
                                    <div class="flip-front bg-[#F5F5F0]">
                                        <img src="${p.images[0]}" class="w-full h-full object-cover object-center">
                                    </div>
                                    <div class="flip-back bg-[#F5F5F0]">
                                        <img src="${p.images[1]}" class="w-full h-full object-cover object-center">
                                    </div>
                                </div>
                            </div>
                            <div class="pt-6 pb-4 text-center">
                                <p class="text-[10px] text-[#B4AEA4] uppercase tracking-[0.2em] mb-2 font-bold">${p.category}</p>
                                <h3 onclick="app.openProduct(${p.id})" class="text-lg text-[#1A1A1A] mb-2 group-hover:text-[#C5A059] transition-colors cursor-pointer font-serif">${p.name}</h3>
                                <p class="font-sans text-sm font-light text-[#555]">${p.price.toLocaleString()} THB</p>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    lucide.createIcons();
                }
            },

            openProduct(id) {
                const product = MOCK_PRODUCTS.find(p => p.id === id);
                this.state.selectedProduct = product;
                this.state.detailQty = 1;
                this.state.detailActiveSize = 'M';
                this.state.currentImageIndex = 0;
                
                document.getElementById('detail-name').innerText = product.name;
                document.getElementById('detail-price').innerText = `${product.price.toLocaleString()} THB`;
                document.getElementById('detail-desc').innerText = product.description;
                
                this.renderGallery();
                this.renderSizeButtons();
                this.switchTab('details');
                this.updateDetailQty(0);
                this.showPage('product');
            },

            // --- SWIPE GALLERY LOGIC ---
            renderGallery() {
                const track = document.getElementById('gallery-track');
                const images = this.state.selectedProduct.images;
                track.innerHTML = images.map(src => 
                    `<div class="gallery-item"><img src="${src}" draggable="false"></div>`
                ).join('');
                this.updateGalleryTransform();
            },

            updateGalleryTransform() {
                const track = document.getElementById('gallery-track');
                track.style.transform = `translateX(-${this.state.currentImageIndex * 100}%)`;
                
                // Update dots
                document.querySelectorAll('.dot').forEach((dot, idx) => {
                    if (idx === this.state.currentImageIndex) dot.classList.add('active', 'scale-125', 'bg-[#1A1A1A]');
                    else dot.classList.remove('active', 'scale-125', 'bg-[#1A1A1A]');
                });
            },

            nextImage() {
                if (this.state.currentImageIndex < this.state.selectedProduct.images.length - 1) {
                    this.state.currentImageIndex++;
                    this.updateGalleryTransform();
                }
            },

            prevImage() {
                if (this.state.currentImageIndex > 0) {
                    this.state.currentImageIndex--;
                    this.updateGalleryTransform();
                }
            },

            goToImage(index) {
                this.state.currentImageIndex = index;
                this.updateGalleryTransform();
            },

            setupSwipe() {
                const area = document.getElementById('swipe-area');
                area.addEventListener('touchstart', e => {
                    this.state.touchStartX = e.changedTouches[0].screenX;
                }, {passive: true});

                area.addEventListener('touchend', e => {
                    this.state.touchEndX = e.changedTouches[0].screenX;
                    this.handleSwipe();
                }, {passive: true});

                // Mouse simulation for desktop
                area.addEventListener('mousedown', e => {
                    this.state.touchStartX = e.screenX;
                });
                area.addEventListener('mouseup', e => {
                    this.state.touchEndX = e.screenX;
                    this.handleSwipe();
                });
            },

            handleSwipe() {
                const threshold = 50;
                if (this.state.touchEndX < this.state.touchStartX - threshold) {
                    this.nextImage(); // Swipe Left
                }
                if (this.state.touchEndX > this.state.touchStartX + threshold) {
                    this.prevImage(); // Swipe Right
                }
            },

            // --- TABS & SIZES ---
            switchTab(tab) {
                const content = document.getElementById('tab-content');
                document.getElementById('tab-details').className = (tab==='details' ? "pb-3 text-xs uppercase tracking-[0.15em] transition-all border-b-2 border-[#1A1A1A] font-bold" : "pb-3 text-xs uppercase tracking-[0.15em] transition-all border-transparent text-[#B4AEA4]");
                document.getElementById('tab-size').className = (tab==='size' ? "pb-3 text-xs uppercase tracking-[0.15em] transition-all border-b-2 border-[#1A1A1A] font-bold" : "pb-3 text-xs uppercase tracking-[0.15em] transition-all border-transparent text-[#B4AEA4]");

                if (tab === 'details') content.innerHTML = `<ul class="list-disc pl-5 space-y-2 animate-enter">${this.state.selectedProduct.details.map(d => `<li>${d}</li>`).join('')}</ul>`;
                else content.innerHTML = `<div class="overflow-x-auto animate-enter"><table class="w-full text-xs text-left"><thead class="bg-[#F5F5F0] uppercase"><tr><th class="p-2">Size</th><th class="p-2">W</th><th class="p-2">L</th></tr></thead><tbody>${SIZE_CHART.map(r => `<tr class="border-b"><td class="p-2">${r.size}</td><td class="p-2">${r.width}</td><td class="p-2">${r.length}</td></tr>`).join('')}</tbody></table></div>`;
            },

            renderSizeButtons() {
                const container = document.getElementById('size-selector');
                container.innerHTML = SIZE_CHART.map(s => `
                    <button onclick="app.setSize('${s.size}')" 
                        class="size-btn w-12 h-12 flex items-center justify-center border font-sans text-sm ${this.state.detailActiveSize === s.size ? 'selected' : 'border-[#EBE5D9] text-[#1A1A1A]'}">
                        ${s.size}
                    </button>
                `).join('');
            },

            setSize(size) {
                this.state.detailActiveSize = size;
                this.renderSizeButtons();
            },

            updateDetailQty(change) {
                const newQty = this.state.detailQty + change;
                if (newQty >= 1) {
                    this.state.detailQty = newQty;
                    document.getElementById('detail-qty').innerText = newQty;
                    const total = this.state.selectedProduct.price * newQty;
                    document.getElementById('detail-add-btn').innerText = `Add to Cart - ${total.toLocaleString()} ฿`;
                }
            },

            addCurrentToCart() {
                const btn = document.getElementById('detail-add-btn');
                
                // Animation Feedback
                btn.classList.add('added');
                setTimeout(() => btn.classList.remove('added'), 1500);

                const item = { ...this.state.selectedProduct, size: this.state.detailActiveSize, quantity: this.state.detailQty };
                const existing = this.state.cart.find(i => i.id === item.id && i.size === item.size);
                if (existing) existing.quantity += item.quantity;
                else this.state.cart.push(item);
                
                this.updateCartUI();
                setTimeout(() => this.toggleCart(true), 300); // Open cart after short delay
            },

            // --- CART & SYSTEM ---
            removeFromCart(index) {
                this.state.cart.splice(index, 1);
                this.updateCartUI();
            },

            toggleCart(isOpen) {
                const drawer = document.getElementById('cart-drawer');
                const content = document.getElementById('cart-content');
                if (isOpen) {
                    drawer.classList.remove('pointer-events-none', 'opacity-0');
                    content.classList.remove('translate-x-full');
                } else {
                    drawer.classList.add('opacity-0');
                    setTimeout(() => drawer.classList.add('pointer-events-none'), 300);
                    content.classList.add('translate-x-full');
                }
            },

            updateCartUI() {
                const container = document.getElementById('cart-items');
                const footer = document.getElementById('cart-footer');
                const empty = document.getElementById('cart-empty-msg');
                const badge = document.getElementById('cart-count');
                const totalEl = document.getElementById('cart-total');
                
                badge.innerText = this.state.cart.length;
                if(this.state.cart.length > 0) badge.classList.remove('hidden'); else badge.classList.add('hidden');

                if (this.state.cart.length === 0) {
                    container.innerHTML = '';
                    footer.classList.add('hidden');
                    empty.classList.remove('hidden');
                    return;
                }

                empty.classList.add('hidden');
                footer.classList.remove('hidden');

                let total = 0;
                container.innerHTML = this.state.cart.map((item, idx) => {
                    total += item.price * item.quantity;
                    return `
                        <div class="flex gap-4 animate-enter" style="animation-delay: ${idx * 0.05}s">
                            <img src="${item.images[0]}" class="w-20 h-24 object-cover border border-[#EBE5D9]">
                            <div class="flex-1">
                                <h3 class="text-sm font-bold font-serif">${item.name}</h3>
                                <p class="text-xs text-[#B4AEA4] mt-1 font-sans">Size: ${item.size} | Qty: ${item.quantity}</p>
                                <p class="text-sm mt-2 font-sans font-light">${(item.price * item.quantity).toLocaleString()} ฿</p>
                            </div>
                            <button onclick="app.removeFromCart(${idx})" class="text-[#B4AEA4] hover:text-red-500 self-start"><i data-lucide="x" width="16"></i></button>
                        </div>
                    `;
                }).join('');
                totalEl.innerText = `${total.toLocaleString()} ฿`;
                lucide.createIcons();
            },

            handleAuthClick() {
                if (this.state.user) {
                    this.state.user = null;
                    document.getElementById('auth-icon').setAttribute('data-lucide', 'user');
                    document.getElementById('admin-btn').classList.add('hidden');
                    this.showPage('home');
                    lucide.createIcons();
                } else {
                    this.showPage('login');
                }
            },

            login() {
                const u = document.getElementById('username').value;
                const p = document.getElementById('password').value;
                if (u === 'admin' && p === 'admin') {
                    this.state.user = { role: 'admin' };
                    document.getElementById('admin-btn').classList.remove('hidden');
                    document.getElementById('auth-icon').setAttribute('data-lucide', 'log-out');
                    this.showPage('admin');
                } else {
                    this.state.user = { role: 'user' };
                    document.getElementById('auth-icon').setAttribute('data-lucide', 'log-out');
                    this.showPage('home');
                }
                lucide.createIcons();
            }
        };

        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>


